{% extends "base.html" %}

{% block title %}我的儀表板{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-blue-50 via-white to-blue-50
            dark:from-gray-900 dark:via-gray-800 dark:to-gray-900
            transition-colors duration-300 py-8">
    <div class="flex justify-center">
        <div class="w-full">
            <h2 class="text-3xl font-bold mb-6 dark:text-gray-100">我的收藏城市</h2>

            {% if reports %}
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 sm:gap-6">
                {% for report in reports %}
                {# 根據天氣圖標動態設定配色 #}
                {% set header_class = 'bg-blue-100' %}
                {% set header_text_class = 'text-blue-900' %}
                {% set body_class = 'bg-blue-50' %}
                {% set border_class = 'border-blue-100' %}

                {% if '01' in report.icon %}
                {% set header_class = 'bg-orange-100' %}
                {% set header_text_class = 'text-orange-900' %}
                {% set body_class = 'bg-orange-50' %}
                {% set border_class = 'border-orange-100' %}
                {% elif '02' in report.icon or '03' in report.icon or '04' in report.icon %}
                {% set header_class = 'bg-slate-100' %}
                {% set header_text_class = 'text-slate-700' %}
                {% set body_class = 'bg-slate-50' %}
                {% set border_class = 'border-slate-200' %}
                {% elif '09' in report.icon or '10' in report.icon %}
                {% set header_class = 'bg-blue-100' %}
                {% set header_text_class = 'text-blue-900' %}
                {% set body_class = 'bg-blue-50' %}
                {% set border_class = 'border-blue-100' %}
                {% elif '11' in report.icon %}
                {% set header_class = 'bg-indigo-100' %}
                {% set header_text_class = 'text-indigo-900' %}
                {% set body_class = 'bg-indigo-50' %}
                {% set border_class = 'border-indigo-100' %}
                {% elif '13' in report.icon %}
                {% set header_class = 'bg-sky-100' %}
                {% set header_text_class = 'text-sky-900' %}
                {% set body_class = 'bg-sky-50' %}
                {% set border_class = 'border-sky-100' %}
                {% elif '50' in report.icon %}
                {% set header_class = 'bg-gray-100' %}
                {% set header_text_class = 'text-gray-800' %}
                {% set body_class = 'bg-gray-50' %}
                {% set border_class = 'border-gray-200' %}
                {% endif %}

                <div
                    class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden border {{ border_class }} dark:border-gray-700 transition-all duration-300 hover:shadow-lg">
                    <div class="{{ header_class }} {{ header_text_class }} dark:bg-gray-700 dark:text-gray-100 p-4">
                        <div class="flex justify-between items-start">
                            <h5 class="text-lg sm:text-xl font-bold">{{ report.city }}</h5>
                            <i class="{{ report.icon | weather_icon }} text-3xl sm:text-4xl"></i>
                        </div>
                    </div>
                    <div class="p-4 sm:p-6 {{ body_class }} dark:bg-gray-800">
                        <h2 class="text-4xl sm:text-5xl font-bold mb-2 dark:text-gray-100">{{ report.temp }}°</h2>
                        <p class="text-sm sm:text-base text-gray-600 dark:text-gray-400 capitalize mb-4">{{
                            report.description }}</p>

                        <div class="space-y-2 text-sm text-gray-600 dark:text-gray-300">
                            <div class="flex justify-between items-center">
                                <span class="flex items-center">
                                    <i class="ri-drop-fill text-blue-500 mr-2"></i>濕度
                                </span>
                                <span class="font-semibold">{{ report.humidity }}%</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="flex items-center">
                                    <i class="ri-windy-fill text-gray-500 mr-2"></i>風速
                                </span>
                                <span class="font-semibold">{{ report.wind_speed }} m/s</span>
                            </div>
                        </div>
                    </div>
                    <div
                        class="bg-gray-50 dark:bg-gray-700 px-4 py-3 border-t border-gray-200 dark:border-gray-600 flex flex-col sm:flex-row gap-2 sm:gap-0 sm:justify-between items-center">
                        <a href="{{ url_for('weather.search', city=report.city) }}"
                            class="inline-block w-full sm:w-auto text-center px-4 py-2 bg-blue-500 dark:bg-blue-600 text-white text-sm font-semibold rounded hover:bg-blue-600 dark:hover:bg-blue-700 transition">
                            詳細資訊
                        </a>
                        <a href="{{ url_for('weather.unsave_city', city=report.city) }}"
                            class="inline-block w-full sm:w-auto text-center px-4 py-2 border border-red-500 dark:border-red-400 text-red-500 dark:text-red-400 text-sm font-semibold rounded hover:bg-red-50 dark:hover:bg-red-900/20 transition">
                            <i class="ri-heart-fill mr-1"></i>移除
                        </a>
                    </div>
                </div>
                {% endfor %}
            </div>
            <nav aria-label="Page navigation" class="mt-8">
                <ul class="flex justify-center gap-2">
                    <!-- 上一頁 -->
                    <li {{ 'class=pointer-events-none' if not pagination.has_prev else '' }}>
                        <a class="px-3 py-2 rounded border transition {{ 'border-gray-300 text-gray-500 dark:border-gray-600 dark:text-gray-500 cursor-not-allowed' if not pagination.has_prev else 'border-blue-500 text-blue-600 dark:border-blue-400 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20' }}"
                            href="{{ url_for('main.dashboard', page=pagination.prev_num) if pagination.has_prev else '#' }}">上一頁</a>
                    </li>

                    <!-- 頁碼 -->
                    {% for p in pagination.iter_pages() %}
                    {% if p %}
                    <li>
                        <a class="px-3 py-2 rounded border transition {{ 'bg-blue-500 border-blue-500 text-white dark:bg-blue-600 dark:border-blue-600' if p == pagination.page else 'border-gray-300 text-gray-700 dark:border-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700' }}"
                            href="{{ url_for('main.dashboard', page=p) }}">{{ p }}</a>
                    </li>
                    {% else %}
                    <li><span class="px-3 py-2 text-gray-500 dark:text-gray-400">...</span></li>
                    {% endif %}
                    {% endfor %}

                    <!-- 下一頁 -->
                    <li {{ 'class=pointer-events-none' if not pagination.has_next else '' }}>
                        <a class="px-3 py-2 rounded border transition {{ 'border-gray-300 text-gray-500 dark:border-gray-600 dark:text-gray-500 cursor-not-allowed' if not pagination.has_next else 'border-blue-500 text-blue-600 dark:border-blue-400 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20' }}"
                            href="{{ url_for('main.dashboard', page=pagination.next_num) if pagination.has_next else '#' }}">下一頁</a>
                    </li>
                </ul>
            </nav>
            {% else %}
            <div
                class="bg-blue-50 dark:bg-gray-800 border border-blue-200 dark:border-blue-800 rounded-lg p-6 sm:p-8 text-center max-w-md mx-auto">
                <div class="text-blue-600 dark:text-blue-400 mb-4">
                    <i class="ri-information-line text-5xl sm:text-6xl"></i>
                </div>
                <h3 class="text-lg sm:text-xl font-semibold mb-2 text-blue-900 dark:text-blue-100">尚未收藏城市</h3>
                <p class="text-sm sm:text-base text-blue-800 dark:text-blue-300 mb-4">
                    探索全球天氣，將喜愛的城市加入收藏
                </p>
                <a href="{{ url_for('main.index') }}"
                    class="inline-block bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700">
                    開始搜尋
                </a>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}